"use strict";const e=require("electron"),i=require("path"),u=require("fs");process.env.DIST=i.join(__dirname,"../dist");process.env.VITE_PUBLIC=e.app.isPackaged?process.env.DIST:i.join(process.env.DIST,"../public");let n,o=null,a=null,c=!1;const l=process.env.VITE_DEV_SERVER_URL;function d(){const t=["icon.ico","icon.png","vite.svg"];for(const s of t){const r=i.join(process.env.VITE_PUBLIC,s);if(u.existsSync(r))return r}return i.join(process.env.VITE_PUBLIC,"vite.svg")}function f(){o||(o=new e.BrowserWindow({width:120,height:120,frame:!1,transparent:!0,resizable:!1,alwaysOnTop:!0,skipTaskbar:!0,webPreferences:{preload:i.join(__dirname,"preload.js"),nodeIntegration:!0,contextIsolation:!1}}),l?(o.loadURL(l+"#/float"),o.webContents.openDevTools({mode:"detach"})):o.loadFile(i.join(process.env.DIST,"index.html"),{hash:"float"}),o.on("close",t=>{c||(t.preventDefault(),o?.hide())}))}function w(){const t=d(),s=e.nativeImage.createFromPath(t);a=new e.Tray(s);const r=e.Menu.buildFromTemplate([{label:"Show App",click:()=>{n?.show()}},{label:"Quit",click:()=>{c=!0,e.app.quit()}}]);a.setToolTip("Time Statistic Analyzer"),a.setContextMenu(r),a.on("double-click",()=>{n?.show()})}function p(){const t=d();n=new e.BrowserWindow({icon:t,webPreferences:{preload:i.join(__dirname,"preload.js"),nodeIntegration:!0,contextIsolation:!1}}),n.on("close",s=>{if(!c)return s.preventDefault(),n?.hide(),!1}),n.webContents.on("did-finish-load",()=>{n?.webContents.send("main-process-message",new Date().toLocaleString())}),l?n.loadURL(l):n.loadFile(i.join(process.env.DIST,"index.html"))}e.app.on("window-all-closed",()=>{process.platform});e.app.on("before-quit",()=>{c=!0});e.app.on("activate",()=>{e.BrowserWindow.getAllWindows().length===0?p():n?.show()});e.app.whenReady().then(()=>{p(),w(),f(),o?.hide(),e.ipcMain.handle("toggle-mini-mode",()=>n?.isVisible()?(n.hide(),o?.show(),!0):(o?.hide(),n?.show(),!1)),e.ipcMain.handle("switch-to-main",()=>(o?.hide(),n?.show(),!1)),e.ipcMain.on("timer-change",()=>{e.BrowserWindow.getAllWindows().forEach(t=>{t.webContents.send("timer-update")})})});
